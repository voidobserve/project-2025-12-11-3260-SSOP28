C51 COMPILER V9.60.7.0   PIN_LEVEL_SCAN                                                    12/12/2025 16:07:28 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PIN_LEVEL_SCAN
OBJECT MODULE PLACED IN .\Release\Objects\pin_level_scan.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\pin_level_scan.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTO
                    -R(0X000C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(
                    -.\Release\Listings\pin_level_scan.lst) OBJECT(.\Release\Objects\pin_level_scan.obj)

line level    source

   1          #include "pin_level_scan.h"
   2          
   3          #if PIN_LEVEL_SCAN_ENABLE
   4          
   5          volatile u16 pin_level_scan_time_cnt;
   6          
   7          void pin_level_scan_config(void)
   8          {
   9   1      #if 0
                  // p21_input_config(); // è¿œå…‰ç¯çŠ¶æ€å¯¹åº”çš„å¼•è„š
                  // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
                  P2_MD0 &= ~(GPIO_P21_MODE_SEL(0x3));
                  // é…ç½®ä¸ºä¸Šæ‹‰
                  P2_PU |= (GPIO_P21_PULL_UP(0x1));
              #endif
  16   1      
  17   1          // å·¦è½¬å‘ç¯å¯¹åº”çš„å¼•è„š
  18   1          P2_MD1 &= ~(GPIO_P25_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  19   1      
  20   1          // å³è½¬å‘ç¯çŠ¶æ€å¯¹åº”çš„å¼•è„š
  21   1          P2_MD0 &= ~(GPIO_P22_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  22   1      
  23   1          // 6æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  24   1          P2_MD1 &= ~(GPIO_P27_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  25   1      
  26   1          // 5æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  27   1          P3_MD0 &= ~(GPIO_P30_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  28   1      
  29   1          // 4æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  30   1          P1_MD1 &= ~(GPIO_P14_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  31   1      
  32   1          // 3æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  33   1          P1_MD0 &= ~(GPIO_P13_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  34   1      
  35   1          // 2æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  36   1          P1_MD0 &= ~(GPIO_P10_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  37   1      
  38   1          // 1æ¡£å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  39   1          P0_MD1 &= ~(GPIO_P07_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  40   1      
  41   1          // ç©ºæŒ¡å¯¹åº”çš„å¼•è„š ï¼ˆç¡¬ä»¶åŸå› ï¼ŒæŒ¡ä½æ£€æµ‹è„šä¸ç”¨å¼€ä¸Šæ‹‰ï¼‰
  42   1          P0_MD1 &= ~(GPIO_P06_MODE_SEL(0x3)); // é…ç½®ä¸ºè¾“å…¥æ¨¡å¼
  43   1      
  44   1          // æ£€æµ‹ æ°´æ¸©æŠ¥è­¦ çš„å¼•è„š:
  45   1          P2_MD0 &= ~(GPIO_P20_MODE_SEL(0x03)); // è¾“å…¥æ¨¡å¼
  46   1          P2_PU |= GPIO_P20_PULL_UP(0x01);      // ä¸Šæ‹‰
  47   1       
  48   1      }
  49          
  50          // å¼•è„šç”µå¹³æ‰«æï¼Œéƒ½æ˜¯ä½ç”µå¹³æœ‰æ•ˆ
  51          void pin_level_scan(void)
  52          {
  53   1          // å¦‚æœåˆ°äº†æ‰«ææ—¶é—´ï¼Œå†æ›´æ–°æŒ¡ä½ã€è½¬å‘ç¯å’Œåˆ¹è½¦çš„çŠ¶æ€
C51 COMPILER V9.60.7.0   PIN_LEVEL_SCAN                                                    12/12/2025 16:07:28 PAGE 2   

  54   1          if (pin_level_scan_time_cnt >= PIN_LEVEL_SCAN_TIME_MS)
  55   1          {
  56   2              pin_level_scan_time_cnt = 0;
  57   2      
  58   2      #if 0  // åˆ¹è½¦æ£€æµ‹
                     // if (PIN_DETECT_BRAKE)
                     // {
                     //     // å¦‚æœæ²¡æœ‰åˆ¹è½¦
                     //     fun_info.brake = OFF;
                     // }
                     // else
                     // {
                     //     // å¦‚æœæœ‰åˆ¹è½¦
                     //     fun_info.brake = ON;
                     // }
              
                      // flag_get_brake = 1;
              #endif // åˆ¹è½¦æ£€æµ‹
  72   2      
  73   2      #if 1 // å·¦è½¬å‘ç¯ã€å³è½¬å‘ç¯ã€è¿œå…‰ç¯
  74   2              if (PIN_DETECT_LEFT_TURN)
  75   2              {
  76   3                  // å¦‚æœå·¦è½¬å‘ç¯æœªå¼€å¯
  77   3                  fun_info.left_turn = OFF;
  78   3              }
  79   2              else
  80   2              {
  81   3                  // å¦‚æœå·¦è½¬å‘ç¯å¼€å¯
  82   3                  fun_info.left_turn = ON;
  83   3              }
  84   2              flag_get_left_turn = 1;
  85   2      
  86   2              if (PIN_DETECT_RIGHT_TURN)
  87   2              {
  88   3                  // å¦‚æœå³è½¬å‘ç¯æœªå¼€å¯
  89   3                  fun_info.right_turn = OFF;
  90   3              }
  91   2              else
  92   2              {
  93   3                  // å¦‚æœå³è½¬å‘ç¯å¼€å¯
  94   3                  fun_info.right_turn = ON;
  95   3              }
  96   2              flag_get_right_turn = 1;
  97   2      
  98   2              // if (PIN_DETECT_HIGH_BEAM)
  99   2              // {
 100   2              //     // å¦‚æœè¿œå…‰ç¯æœªå¼€å¯
 101   2              //     fun_info.high_beam = OFF;
 102   2              // }
 103   2              // else
 104   2              // {
 105   2              //     // å¦‚æœè¿œå…‰ç¯å¼€å¯
 106   2              //     fun_info.high_beam = ON;
 107   2              // }
 108   2              // flag_get_high_beam = 1;
 109   2      #endif
 110   2      
 111   2              // ä»¥æœ€ä½æŒ¡ä½ä¼˜å…ˆï¼Œå½“æœ€ä½æ¡£æœ‰ä¿¡å·æ—¶ï¼Œä¸ç®¡å…¶ä»–æŒ¡ä½çš„ä¿¡å·ï¼Œç›´æ¥ä»¥æœ€ä½
             -æ¡£çš„ä¸ºä¸»
 112   2              if (0 == PIN_DETECT_NEUTRAL_GEAR)
 113   2              {
 114   3                  // ç©ºæŒ¡
C51 COMPILER V9.60.7.0   PIN_LEVEL_SCAN                                                    12/12/2025 16:07:28 PAGE 3   

 115   3                  fun_info.gear = GEAR_NEUTRAL;
 116   3              }
 117   2              else if (0 == PIN_DETECT_FIRST_GEAR)
 118   2              {
 119   3                  // ä¸€æ¡£
 120   3                  fun_info.gear = GEAR_FIRST;
 121   3              }
 122   2              else if (0 == PIN_DETECT_SECOND_GEAR)
 123   2              {
 124   3                  // äºŒæ¡£
 125   3                  fun_info.gear = GEAR_SECOND;
 126   3              }
 127   2              else if (0 == PIN_DETECT_THIRD_GEAR)
 128   2              {
 129   3                  // ä¸‰æ¡£
 130   3                  fun_info.gear = GEAR_THIRD;
 131   3              }
 132   2              else if (0 == PIN_DETECT_FOURTH_GEAR)
 133   2              {
 134   3                  // å››æ¡£
 135   3                  fun_info.gear = GEAR_FOURTH;
 136   3              }
 137   2              else if (0 == PIN_DETECT_FIFTH_GEAR)
 138   2              {
 139   3                  // äº”æ¡£
 140   3                  fun_info.gear = GEAR_FIFTH;
 141   3              }
 142   2              else if (0 == PIN_DETECT_XIXTH_GEAR)
 143   2              {
 144   3                  // å…­æ¡£
 145   3                  fun_info.gear = GEAR_SIXTH;
 146   3              }
 147   2              else
 148   2              {
 149   3                  /*
 150   3                      ç©ºæŒ¡ã€ä¸€æ¡£ ~ å…­æ¡£éƒ½æ²¡æœ‰æ£€æµ‹åˆ°ï¼Œåˆ™èµ‹å€¼ä¸º GEAR_UNKNOWN
 151   3                      è®©æ˜¾ç¤ºå±ä¸­æ¡£ä½å¯¹åº”çš„å›¾æ ‡ç©ºç€
 152   3                  */
 153   3                  fun_info.gear = GEAR_UNKNOWN;
 154   3              }
 155   2      
 156   2              // printf("cur gear %bu\n", fun_info.gear);
 157   2              flag_get_gear = 1;
 158   2      
 159   2              if (0 == PIN_DETECT_TEMP_OF_WATER_ALERT)
 160   2              {
 161   3      
 162   3                  // å¦‚æœæ£€æµ‹åˆ°æ°´æ¸©æŠ¥è­¦
 163   3                  fun_info.flag_is_in_water_temp_warning = 1;
 164   3              }
 165   2              else
 166   2              {
 167   3                  // å¦‚æœæœªæ£€æµ‹åˆ°æ°´æ¸©æŠ¥è­¦
 168   3                  fun_info.flag_is_in_water_temp_warning = 0;
 169   3              }
 170   2              flag_set_temp_of_water_warning = 1;
 171   2      
 172   2              if (0 == PIN_DETECT_MALFUNCTION)
 173   2              {
 174   3                  // å¦‚æœæ£€æµ‹åˆ°äº†æ•…éšœ
 175   3                  fun_info.flag_is_detect_malfunction = 1;
 176   3      
C51 COMPILER V9.60.7.0   PIN_LEVEL_SCAN                                                    12/12/2025 16:07:28 PAGE 4   

 177   3                  // æ²¡æœ‰å¼•è„šæ£€æµ‹absçš„çŠ¶æ€ï¼Œè¿™é‡Œæ£€æµ‹åˆ°æ•…éšœåï¼Œä¹Ÿé¡ºä¾¿è®¾ç½®absçš„çŠ¶æ€
 178   3                  // fun_info.flag_is_detect_abs = 1;
 179   3              }
 180   2              else
 181   2              {
 182   3                  // å¦‚æœæœªæ£€æµ‹åˆ°æ•…éšœ
 183   3                  fun_info.flag_is_detect_malfunction = 0;
 184   3      
 185   3                  // æ²¡æœ‰å¼•è„šæ£€æµ‹absçš„çŠ¶æ€ï¼Œè¿™é‡Œæ›´æ–°æ•…éšœçš„çŠ¶æ€åï¼Œä¹Ÿé¡ºä¾¿è®¾ç½®absçš„çŠ¶æ
             -€
 186   3                  // fun_info.flag_is_detect_abs = 0;
 187   3              }
 188   2      
 189   2              //   printf("cur malfunction %bu\n", fun_info.flag_is_detect_malfunction);
 190   2      
 191   2              flag_update_malfunction_status = 1;
 192   2          }
 193   1      
 194   1          // if () // ACCå¼•è„šæ£€æµ‹ï¼Œæ£€æµ‹åˆ°é«˜ç”µå¹³ï¼ŒP03ä¹Ÿè¾“å‡ºé«˜ç”µå¹³ï¼Œæ£€æµ‹åˆ°ä½ç”µå¹³ï¼Œè®©P03
             -è¾“å‡ºä½ç”µå¹³
 195   1          // if (P04)
 196   1          // {
 197   1          //     // æ£€æµ‹åˆ°ACCä¸ºé«˜ç”µå¹³,
 198   1          //     P03 = 1;
 199   1          // }
 200   1          // else
 201   1          // {
 202   1          //     P03 = 0;
 203   1          // }
 204   1      }
 205          
 206          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    232    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
