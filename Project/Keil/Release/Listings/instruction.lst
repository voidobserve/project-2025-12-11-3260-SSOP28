C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE INSTRUCTION
OBJECT MODULE PLACED IN .\Release\Objects\instruction.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\instruction.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0
                    -X000C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\R
                    -elease\Listings\instruction.lst) OBJECT(.\Release\Objects\instruction.obj)

line level    source

   1          #include "instruction.h"
   2          
   3          #include <string.h> // memset()
   4          
   5          // ç”¨bitå®šä¹‰ï¼Œæ¥èŠ‚çœç©ºé—´
   6          // ä¸‹é¢çš„æ ‡å¿—ä½ï¼Œæœ‰å¯èƒ½æ˜¯ä»ä¸²å£æ¥æ”¶åˆ°äº†æŒ‡ä»¤æ¥ç½®ä½ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å…¶ä»–çš„æ‰«æå
             -‡½æ•°æ›´æ–°äº†çŠ¶æ€æ¥ç½®ä½
   7          volatile bit flag_get_all_status; // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
   8          volatile bit flag_get_gear;       // è·å–æŒ¡ä½çŠ¶æ€ / å¾—åˆ°äº†æŒ¡ä½çš„çŠ¶æ€
   9          volatile bit flag_get_battery;    // è·å–ç”µæ± çŠ¶æ€ / å¾—åˆ°äº†ç”µæ± çš„çŠ¶æ€ï¼ˆç”µæ± ç”µé‡ï¼Œå•ä½
             -ï¼šç™¾åˆ†æ¯”ï¼‰
  10          // volatile bit flag_get_brake;        // è·å–åˆ¹è½¦çŠ¶æ€ / å¾—åˆ°äº†åˆ¹è½¦çš„çŠ¶æ€
  11          volatile bit flag_get_left_turn;  // è·å–å·¦è½¬å‘ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†å·¦è½¬å‘ç¯çš„çŠ¶æ€
  12          volatile bit flag_get_right_turn; // è·å–å³è½¬å‘ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†å³è½¬å‘ç¯çš„çŠ¶æ€
  13          // volatile bit flag_get_high_beam;    // è·å–è¿œå…‰ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†è¿œå…‰ç¯çš„çŠ¶æ€
  14          volatile bit flag_get_engine_speed; // è·å–å‘åŠ¨æœºçš„è½¬é€Ÿ / å¾—åˆ°äº†å‘åŠ¨æœºçš„è½¬é€Ÿ
  15          volatile bit flag_get_speed;        // è·å–æ—¶é€Ÿ / å¾—åˆ°äº†æ—¶é€Ÿ
  16          volatile bit flag_get_fuel;         // è·å–æ²¹é‡ / å¾—åˆ°äº†æ²¹é‡ï¼ˆå•ä½ï¼šç™¾åˆ†æ¯”ï¼‰
  17          #if TEMP_OF_WATER_SCAN_ENABLE
              // volatile bit flag_get_temp_of_water = 0; // è·å–æ°´æ¸© / å¾—åˆ°äº†æ°´æ¸©
              #endif
  20          volatile bit flag_update_malfunction_status; // æ ‡å¿—ä½ï¼Œæ›´æ–°æ•…éšœçŠ¶æ€
  21          volatile bit flag_update_abs_status;         // æ ‡å¿—ä½ï¼Œæ›´æ–°absçš„çŠ¶æ€
  22          
  23          volatile bit flag_get_total_mileage;       // è·å–å¤§è®¡é‡Œç¨‹ / å¾—åˆ°äº†å¤§è®¡é‡Œç¨‹(æ•°æ®éœ€è¦æ›´æ–
             -°)
  24          volatile bit flag_get_sub_total_mileage;   // è·å–å°è®¡é‡Œç¨‹ / å¾—åˆ°äº†å°è®¡é‡Œç¨‹(æ•°æ®éœ€è¦æ›´æ–
             -°)
  25          volatile bit flag_get_sub_total_mileage_2; // è·å–å°è®¡é‡Œç¨‹2 / å¾—åˆ°äº†å°è®¡é‡Œç¨‹2(æ•°æ®éœ€è¦æ›´
             -æ–°)
  26          
  27          // volatile bit flag_get_touch_key_status = 0; // è·å–è§¦æ‘¸æŒ‰é”®çš„çŠ¶æ€
  28          // volatile bit flag_alter_date = 0; // ä¿®æ”¹æ—¥æœŸ
  29          volatile bit flag_alter_time; // ä¿®æ”¹æ—¶é—´
  30          
  31          volatile bit flag_get_voltage_of_battery; // è·å–ç”µæ± ç”µå‹
  32          
  33          // #if TEMP_OF_WATER_SCAN_ENABLE
  34          volatile bit flag_set_temp_of_water_warning = 0; // è®¾ç½®æ°´æ¸©æŠ¥è­¦
  35          // #endif
  36          
  37          volatile bit flag_clear_total_mileage;       // æ¸…é™¤å¤§è®¡é‡Œç¨‹
  38          volatile bit flag_clear_sub_total_mileage;   // æ¸…é™¤å°è®¡é‡Œç¨‹
  39          volatile bit flag_clear_sub_total_mileage_2; // æ¸…é™¤å°è®¡é‡Œç¨‹2
  40          
  41          volatile u8 synchronous_request_status;    // åŒæ­¥è¯·æ±‚çŠ¶æ€æœº
  42          volatile u16 synchronous_request_time_cnt; // åŒæ­¥è¯·æ±‚æ—¶é—´è®¡æ—¶
  43          
  44          volatile u8 update_time_status; // æ›´æ–°æ—¶é—´çš„çŠ¶æ€æœº
  45          // volatile u8 update_date_status = 0; // æ›´æ–°æ—¥æœŸçš„çŠ¶æ€æœº
  46          
  47          volatile u16 update_time_cooling_cnt; // æ›´æ–°æ—¶é—´çš„å†·å´è®¡æ•°
  48          // volatile u16 update_date_cooling_cnt = 0; // æ›´æ–°æ—¥æœŸçš„å†·å´è®¡æ•°
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 2   

  49          
  50          // // å­˜æ”¾æ¥æ”¶åˆ°çš„è®¾ç½®æ°´æ¸©æŠ¥è­¦çš„æŒ‡ä»¤ä¸­ï¼Œå¯¹åº”çš„æ“ä½œï¼Œé»˜è®¤ä¸ºæ— æ“ä½œ
  51          // volatile u8 operation_set_temp_of_water_warning = OPERATION_SET_TEMP_OF_WATER_WARNING_NONE;
  52          
  53          // æ£€æŸ¥æ¥æ”¶æ˜¯å¦æ­£ç¡®çš„å‡½æ•°ï¼Œå¦‚æœæ¥æ”¶æ­£ç¡®ï¼Œ
  54          // æ ¹æ®æ¥æ”¶åˆ°çš„æ•°æ®ä¸­çš„æŒ‡ä»¤ï¼Œç»™å¯¹åº”çš„æŒ‡ä»¤çš„æ ‡å¿—ä½ç½®ä¸€
  55          void instruction_scan(void)
  56          {
  57   1          u8 i = 0; // æ³¨æ„è¦å¤§äºç­‰äºç¼“å†²åŒºèƒ½å­˜æ”¾çš„æŒ‡ä»¤æ•°ç›®
  58   1          for (i = 0; i < (UART0_RXBUF_LEN) / (FRAME_MAX_LEN); i++)
  59   1          {
  60   2              if (flagbuf_valid_instruction[i]) // å¦‚æœå¯¹åº”çš„ä½ç½®æœ‰åˆæ³•çš„æ•°æ®å¸§
  61   2              {
  62   3                  // æ ¹æ®æ¥æ”¶åˆ°æ•°æ®ä¸­çš„æŒ‡ä»¤ï¼Œç»™å¯¹åº”çš„æŒ‡ä»¤çš„æ ‡å¿—ä½ç½®ä¸€
  63   3                  // if (4 == uart0_recv_buf[i][1]) // å¦‚æœæ˜¯å››ä½é•¿åº¦çš„æŒ‡ä»¤
  64   3                  {
  65   4                      switch (uart0_recv_buf[i][2]) // æ ¹æ®ä¸åŒçš„æŒ‡ä»¤æ¥ç»™å¯¹åº”çš„æ ‡å¿—ä½ç½®ä¸€
  66   4                      {
  67   5                      case INSTRUCTION_GET_ALL_STATUS: // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
  68   5                          flag_get_all_status = 1;
  69   5                          break;
  70   5      
  71   5                      case INSTRUCTION_GET_TOTAL_MILEAGE: // è·å–å¤§è®¡é‡Œç¨‹
  72   5                          flag_get_total_mileage = 1;
  73   5                          break;
  74   5      
  75   5                      case INSTRUCTION_GET_SUBTOTAL_MILEAGE: // è·å–å°è®¡é‡Œç¨‹
  76   5                          flag_get_sub_total_mileage = 1;
  77   5                          break;
  78   5      
  79   5                      case INSTRUCTION_GET_SUBTOTAL_MILEAGE_2: // è·å–å°è®¡é‡Œç¨‹2
  80   5                          flag_get_sub_total_mileage_2 = 1;
  81   5                          break;
  82   5      
  83   5                      case INSTRUCTION_ALTER_TIME: // ä¿®æ”¹æ—¶é—´
  84   5                          flag_alter_time = 1;
  85   5      
  86   5                          fun_info.aip1302_saveinfo.year = (u16)((u32)uart0_recv_buf[i][3] << 8) +
  87   5                                                           (u16)uart0_recv_buf[i][4];
  88   5                          fun_info.aip1302_saveinfo.month = uart0_recv_buf[i][5];
  89   5                          fun_info.aip1302_saveinfo.day = uart0_recv_buf[i][6];
  90   5      
  91   5                          fun_info.aip1302_saveinfo.time_hour = uart0_recv_buf[i][7];
  92   5                          fun_info.aip1302_saveinfo.time_min = uart0_recv_buf[i][8];
  93   5                          fun_info.aip1302_saveinfo.time_sec = uart0_recv_buf[i][9];
  94   5      
  95   5      #if USE_MY_DEBUG
              #if 0 // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              
                                  {
                                      u8 i = 0;
                                      u8 j = 0;
                                      for (i = 0; i < (UART0_RXBUF_LEN) / (FRAME_MAX_LEN); i++)
                                      {
                                          printf("buff_index %bu ", i);
                                          for (j = 0; j < FRAME_MAX_LEN; j++)
                                          {
                                              printf("%bx ", uart0_recv_buf[i][j]);
                                          }
                                          printf("\n");
                                      }
                                  }
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 3   

              
              #endif // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              #endif
 114   5      
 115   5                          break;
 116   5      
 117   5                      case INSTRUCTION_CLEAR_TOTAL_MILEAGE: // æ¸…é™¤å¤§è®¡é‡Œç¨‹
 118   5                          flag_clear_total_mileage = 1;
 119   5                          break;
 120   5      
 121   5                      case INSTRUCTION_CLEAR_SUBTOTAL_MILEAGE: // æ¸…é™¤å°è®¡é‡Œç¨‹
 122   5                          flag_clear_sub_total_mileage = 1;
 123   5                          // printf("clear\n");
 124   5                          break;
 125   5      
 126   5                      case INSTRUCTION_CLEAR_SUBTOTAL_MILEAGE_2: // æ¸…é™¤å°è®¡é‡Œç¨‹2
 127   5                          flag_clear_sub_total_mileage_2 = 1;
 128   5                          break;
 129   5                      }
 130   4      
 131   4                      if (recv_frame_cnt > 0) //
 132   4                      {
 133   5                          recv_frame_cnt--; // ä»ä¸²å£æ¥æ”¶çš„æ•°æ®å¸§æ•°ç›®å‡ä¸€ï¼Œè¡¨ç¤ºæŒ‡ä»¤å·²ç»ä»ç¼
             -“å†²åŒºå–å‡º
 134   5                      }
 135   4      
 136   4                      flagbuf_valid_instruction[i] = 0; // æ¸…ç©ºç¼“å†²åŒºå¯¹åº”çš„å…ƒç´ ï¼Œè¡¨ç¤ºè¯¥ä¸‹æ ‡çš„æŒ
             -‡ä»¤å·²ç»å¤„ç†
 137   4                      uart0_recv_len[i] = 0;
 138   4                      recved_flagbuf[i] = 0;
 139   4                      memset(uart0_recv_buf[i], 0, FRAME_MAX_LEN); // æ¸…ç©ºç¼“å†²åŒºå¯¹åº”çš„å…ƒç´ 
 140   4                  } // if (4 == uart0_recv_buf[i][1])
 141   3              }
 142   2          }
 143   1      }
 144          
 145          void instruction_handle(void)
 146          { 
 147   1          if (flag_get_all_status)
 148   1          {
 149   2              // å¦‚æœè¦è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
 150   2              // u32 temp_val = 0;        // ä¸´æ—¶å˜é‡(åœ¨å‘é€æ—¥æœŸå’Œæ—¶é—´ä½¿ç”¨åˆ°)
 151   2              flag_get_all_status = 0; // æ¸…é™¤æ ‡å¿—ä½
 152   2      
 153   2      #if USE_MY_DEBUG
                      // printf(" flag_get_all_status\n");
              #endif
 156   2      
 157   2              if (synchronous_request_status == SYN_REQUEST_STATUS_NONE)
 158   2              {
 159   3                  // printf("handle get_all_status\n");// æµ‹è¯•é€šè¿‡ï¼Œæ¯æ¬¡æ”¶åˆ°åŒæ­¥è¯·æ±‚ï¼Œéƒ½ä¼šç­‰å¾…
             -å†·å´åï¼Œæ‰å¤„ç†ä¸‹ä¸€æ¬¡åŒæ­¥è¯·æ±‚
 160   3                  synchronous_request_status = SYN_REQUEST_STATUS_HANDLING;
 161   3                  // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€ï¼Œéœ€è¦æŠŠè¿™äº›åŠŸèƒ½å¯¹åº”çš„çŠ¶æ€éƒ½å‘é€å‡ºå»
 162   3                  send_data_packet(SEND_GEAR);            // å‘é€å½“å‰æŒ¡ä½çš„çŠ¶æ€
 163   3                  send_data_packet(SEND_BATTERY);         // å‘é€ç”µæ± ç”µé‡
 164   3                  send_data_packet(SEND_ENGINE_SPEED);    // å‘é€å‘åŠ¨æœºè½¬é€Ÿ
 165   3                  send_data_packet(SEND_SPEED);           // å‘é€å½“å‰é‡‡é›†åˆ°çš„è½¦é€Ÿï¼ˆæ—¶é€Ÿï¼‰
 166   3                  send_data_packet(SEND_SPEED_WITH_MILE); // å‘é€æ—¶é€Ÿï¼ˆå•ä½ï¼šè‹±é‡Œæ¯å°æ—¶ mile/hï¼‰ 1
             -km/h == 0.621427mile/h
 167   3                  send_data_packet(SEND_FUEL);            // å‘é€å½“å‰æ²¹é‡(å•ä½ï¼šç™¾åˆ†æ¯”)
 168   3      
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 4   

 169   3                  send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_KM);   // å‘é€å¤§è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ
             - å•ä½ï¼š 0.1 km
 170   3                  send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_MILE); // å‘é€å¤§è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ
             - å•ä½ï¼š 0.1 mile
 171   3      
 172   3                  send_data_packet(SEND_SUBTOTAL_MILEAGE_TENTH_OF_KM);   // å‘é€å¤§è®¡é‡Œç¨‹ï¼ˆæ€»é‡Œç¨‹ï¼Œå•
             -ä½ï¼šè‹±é‡Œ mileï¼‰ï¼Œåªå‘é€1è‹±é‡Œä»¥ä¸Šçš„æ•°æ®
 173   3                  send_data_packet(SEND_SUBTOTAL_MILEAGE_TENTH_OF_MILE); // å‘é€å°è®¡é‡Œç¨‹ï¼ˆæ€»é‡Œç¨‹ï¼Œå•
             -ä½ï¼š0.1 è‹±é‡Œ 0.1 mileï¼‰ï¼Œåªå‘é€0.1è‹±é‡Œä»¥ä¸Šçš„æ•°æ®
 174   3      
 175   3      #if IC_1302_ENABLE
 176   3                  aip1302_read_all(); // å…ˆä»aip1302æ—¶é’Ÿicè·å–æ‰€æœ‰å…³äºæ—¶é—´çš„ä¿¡æ¯ï¼Œå†å‘é€
 177   3      
 178   3                  send_data_packet(SEND_TIME);
 179   3                  // printf("time send\n");
 180   3      #endif // #if IC_1302_ENABLE
 181   3      
 182   3                  // å‘é€å½“å‰çš„ç”µæ± ç”µå‹
 183   3                  send_data_packet(SEND_VOLTAGE_OF_BATTERY);
 184   3      
 185   3                  send_data_packet(SEND_TEMP_OF_WATER_ALERT);
 186   3      
 187   3                  // send_data_packet(SEND_SUBTOTAL_MILEAGE_2);                    // å‘é€å°è®¡é‡Œç¨‹2(åªå‘
             -é€ç™¾ç±³åŠä»¥ä¸Šçš„æ•°æ®)
 188   3                  // send_data_packet(SEND_SUBTOTAL_MILEAGE_2_WITH_TENTH_OF_MILE); // å‘é€å°è®¡é‡Œç¨‹2(åªå‘
             -é€0.1è‹±é‡ŒåŠä»¥ä¸Šçš„æ•°æ®)
 189   3              }
 190   2          }
 191   1      
 192   1          if (flag_get_left_turn)
 193   1          {
 194   2              flag_get_left_turn = 0;
 195   2              send_data_packet(SEND_LEFT_TURN);
 196   2          }
 197   1      
 198   1          if (flag_get_right_turn)
 199   1          {
 200   2              flag_get_right_turn = 0;
 201   2              send_data_packet(SEND_RIGHT_TURN);
 202   2          }
 203   1      
 204   1          if (flag_get_gear) // å¦‚æœè¦è·å–æŒ¡ä½çš„çŠ¶æ€
 205   1          {
 206   2              flag_get_gear = 0; //
 207   2      
 208   2      #if USE_MY_DEBUG
                      // printf(" flag_get_gear\n");
              #endif
 211   2      
 212   2              send_data_packet(SEND_GEAR); // å‘é€å½“å‰æŒ¡ä½çš„çŠ¶æ€
 213   2                                           // printf("cur gear %u\n", fun_info.gear);
 214   2          } //  if (flag_get_gear) // å¦‚æœè¦è·å–æŒ¡ä½çš„çŠ¶æ€
 215   1      
 216   1          if (flag_get_battery)
 217   1          {
 218   2              // å¦‚æœè¦è·å–ç”µæ± ç”µé‡çš„çŠ¶æ€
 219   2              flag_get_battery = 0;
 220   2      #if USE_MY_DEBUG
                      // printf(" flag_get_battery\n");
              #endif
 223   2      
 224   2              send_data_packet(SEND_BATTERY); // å‘é€ç”µæ± ç”µé‡
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 5   

 225   2          }
 226   1      
 227   1          if (flag_get_engine_speed)
 228   1          {
 229   2              // å¦‚æœè¦è·å–å‘åŠ¨æœºçš„è½¬é€Ÿ
 230   2              flag_get_engine_speed = 0;
 231   2      #if USE_MY_DEBUG
                      // printf(" flag_get_engine_speed \n");
                      // printf(" cur engine speed %u rpm ", (u16)fun_info.engine_speeed);
              #endif
 235   2              send_data_packet(SEND_ENGINE_SPEED); //
 236   2          }
 237   1      
 238   1          if (flag_get_speed)
 239   1          {
 240   2              // å¦‚æœè¦è·å–æ—¶é€Ÿ ï¼ˆé€Ÿåº¦ï¼‰
 241   2              flag_get_speed = 0;
 242   2      #if USE_MY_DEBUG
                      // printf(" flag_get_speed \n");
              #endif
 245   2      
 246   2              send_data_packet(SEND_SPEED); // å‘é€å½“å‰é‡‡é›†åˆ°çš„è½¦é€Ÿï¼ˆæ—¶é€Ÿï¼‰
 247   2                                            // printf("cur speed %lu km/h\n", fun_info.speed);
 248   2      
 249   2              // 1km/h == 0.621427mile/h
 250   2              send_data_packet(SEND_SPEED_WITH_MILE);
 251   2          }
 252   1      
 253   1          if (flag_get_fuel)
 254   1          {
 255   2              // å¦‚æœè¦è·å–æ²¹é‡
 256   2              flag_get_fuel = 0;
 257   2      
 258   2      #if USE_MY_DEBUG
                      // printf(" flag_get_fuel \n");
              #endif
 261   2      
 262   2              send_data_packet(SEND_FUEL);
 263   2          }
 264   1      
 265   1          if (flag_update_malfunction_status) // æ›´æ–°æ•…éšœçš„çŠ¶æ€
 266   1          {
 267   2              flag_update_malfunction_status = 0;
 268   2              send_data_packet(SEND_MALFUNCTION_STATUS);
 269   2      
 270   2              // æ²¡æœ‰å¼•è„šæ£€æµ‹ABSï¼Œé‚£ä¹ˆæ£€æµ‹åˆ°æ•…éšœä¹‹åï¼Œä¹Ÿå‘é€ABSçš„çŠ¶æ€
 271   2              // send_data_packet(SEND_ABS_STATUS);
 272   2          }
 273   1      
 274   1          if (flag_get_total_mileage) // å¦‚æœè¦è·å–å¤§è®¡é‡Œç¨‹ / å¾—åˆ°äº†å¤§è®¡é‡Œç¨‹æ–°çš„æ•°æ®
 275   1          {
 276   2              flag_get_total_mileage = 0;
 277   2      #if USE_MY_DEBUG
                      // printf(" flag_get_total_mileage \n");
                      // printf(" cur total mileage %lu m \n", (u32)fun_info.save_info.total_mileage);
              #endif
 281   2      
 282   2              // åªå‘é€åƒç±³åŠä»¥ä¸Šçš„æ•°æ®
 283   2              // send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_KM);
 284   2              // send_data_packet(SEND_TOTAL_MILEAGE_WITH_MILE); // 1km == 0.621427mile
 285   2          }
 286   1      
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 6   

 287   1          if (flag_get_sub_total_mileage) // å¦‚æœè¦è·å–å°è®¡é‡Œç¨‹ / å¾—åˆ°äº†å°è®¡é‡Œç¨‹æ–°çš„æ•°æ®
 288   1          {
 289   2      
 290   2              flag_get_sub_total_mileage = 0;
 291   2              // printf(" cur subtotal mileage %lu m \n", (u32)fun_info.save_info.subtotal_mileage);
 292   2      
 293   2              // åªå‘é€ç™¾ç±³åŠä»¥ä¸Šçš„æ•°æ®
 294   2              send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_KM);
 295   2      
 296   2              // 1km == 0.621427mileï¼Œ1km == 6.21427 * 0.1 mile
 297   2              // send_data_packet(SEND_SUBTOTAL_MILEAGE_WITH_TENTH_OF_MILE);
 298   2          }
 299   1      
 300   1          if (flag_get_sub_total_mileage_2) // // å¦‚æœè¦è·å–å°è®¡é‡Œç¨‹2 / å¾—åˆ°äº†å°è®¡é‡Œç¨‹2æ–°çš„æ•°
             -æ®
 301   1          {
 302   2              flag_get_sub_total_mileage_2 = 0;
 303   2              // åªå‘é€ç™¾ç±³åŠä»¥ä¸Šçš„æ•°æ®
 304   2              // send_data_packet(SEND_SUBTOTAL_MILEAGE_2);
 305   2              // 1km == 0.621427mileï¼Œ1km == 6.21427 * 0.1 mile
 306   2              // send_data_packet(SEND_SUBTOTAL_MILEAGE_2_WITH_TENTH_OF_MILE);
 307   2          }
 308   1      
 309   1          if (flag_set_temp_of_water_warning)
 310   1          {
 311   2              flag_set_temp_of_water_warning = 0;
 312   2      
 313   2              send_data_packet(SEND_TEMP_OF_WATER_ALERT);
 314   2          }
 315   1      
 316   1          if (flag_set_temp_of_water_warning)
 317   1          {
 318   2              flag_set_temp_of_water_warning = 0;
 319   2      
 320   2              send_data_packet(SEND_TEMP_OF_WATER_ALERT);
 321   2          }
 322   1      
 323   1      #if IC_1302_ENABLE
 324   1          if (flag_alter_time)
 325   1          {
 326   2              // å¦‚æœè¦ä¿®æ”¹æ—¶é—´
 327   2              flag_alter_time = 0;
 328   2      
 329   2              // printf("get update time cmd\n");
 330   2      
 331   2      #if USE_MY_DEBUG
                      // printf(" flag_alter_time \n");
                      // printf("==================================\n");
                      // printf("year %u \n", fun_info.aip1302_saveinfo.year);
                      // printf("month %bu \n", fun_info.aip1302_saveinfo.month);
                      // printf("day %bu \n", fun_info.aip1302_saveinfo.day);
                      // printf("hour %bu min %bu sec %bu \n", fun_info.aip1302_saveinfo.time_hour, fun_info.aip1302_sav
             -einfo.time_min, fun_info.aip1302_saveinfo.time_sec);
              #endif
 339   2      
 340   2              if (update_time_status == UPDATE_STATUS_NONE)
 341   2              {
 342   3                  // printf("handle update_time \n");
 343   3                  // å¦‚æœæ›´æ–°æ—¶é—´çš„çŠ¶æ€å·²ç»å†·å´å®Œæ¯•ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¹¶ä¸”è¿›å…¥å†·å´çŠ¶æ€ï¼Œ
 344   3                  // åˆ‡æ¢çŠ¶æ€ï¼Œè®©å®šæ—¶å™¨è¿›è¡Œå†·å´è®¡æ—¶
 345   3                  aip1302_update_time(fun_info.aip1302_saveinfo); // å°†æ—¶é—´æ›´æ–°åˆ°æ—¶é’Ÿic
 346   3                  update_time_status = UPDATE_STATUS_HANDLING;
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       12/12/2025 16:07:28 PAGE 7   

 347   3                  // printf("time updated\n");
 348   3              }
 349   2          }
 350   1      #endif // #if IC_1302_ENABLE
 351   1      
 352   1          if (flag_get_voltage_of_battery)
 353   1          {
 354   2              // å¦‚æœè¦è·å–ç”µæ± ç”µå‹
 355   2              flag_get_voltage_of_battery = 0;
 356   2      #if USE_MY_DEBUG
                      // printf(" flag_get_voltage_of_battery \n");
                      // printf(" cur voltage of battery %u \n", (u16)fun_info.voltage_of_battery);
              #endif
 360   2              send_data_packet(SEND_VOLTAGE_OF_BATTERY);
 361   2          }
 362   1      
 363   1          if (flag_clear_total_mileage)
 364   1          {
 365   2              // å¦‚æœè¦æ¸…é™¤å¤§è®¡é‡Œç¨‹
 366   2              flag_clear_total_mileage = 0;
 367   2              fun_info.save_info.total_mileage = 0;
 368   2              distance = 0;    //
 369   2              fun_info_save(); // å°†ä¿¡æ¯å†™å›flash
 370   2      #if USE_MY_DEBUG
                      // printf(" flag_clear_total_mileage \n");
              #endif
 373   2          }
 374   1      
 375   1          if (flag_clear_sub_total_mileage)
 376   1          {
 377   2              // å¦‚æœè¦æ¸…é™¤å°è®¡é‡Œç¨‹
 378   2              flag_clear_sub_total_mileage = 0;
 379   2              fun_info.save_info.subtotal_mileage = 0;
 380   2              distance = 0;
 381   2              fun_info_save(); // å°†ä¿¡æ¯å†™å›flash
 382   2      #if USE_MY_DEBUG
                      // printf(" flag_clear_sub_total_mileage \n");
              #endif
 385   2          }
 386   1      
 387   1          if (flag_clear_sub_total_mileage_2) // å¦‚æœè¦æ¸…é™¤å°è®¡é‡Œç¨‹2
 388   1          {
 389   2              flag_clear_sub_total_mileage_2 = 0;
 390   2              fun_info.save_info.subtotal_mileage_2 = 0;
 391   2              distance = 0;
 392   2              fun_info_save(); // å°†ä¿¡æ¯å†™å›flash
 393   2          }
 394   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    706    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     19    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
