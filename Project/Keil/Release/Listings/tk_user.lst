C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TK_USER
OBJECT MODULE PLACED IN .\Release\Objects\tk_user.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\tk_user.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Lis
                    -tings\tk_user.lst) OBJECT(.\Release\Objects\tk_user.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    User/tk_user.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-20-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2022 TAIXIN-IC</center></h2>
  12           *
  13           *
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          #include "my_config.h"
  21          
  22          // /**
  23          //  * @brief  ç”¨æˆ·ä»£ç åˆå§‹åŒ–å‡½æ•°æ¥å£.
  24          //  * @param  None
  25          //  * @retval None
  26          //  */
  27          // void user_init(void)
  28          // {
  29          //     fun_info_init(); // åˆå§‹åŒ–ç”¨äºå­˜æ”¾ä¿¡æ¯çš„å˜é‡
  30          
  31          //     tmr0_config();           // ä¸²å£æ£€æµ‹æ•°æ®è¶…æ—¶éœ€è¦ä½¿ç”¨åˆ°çš„å®šæ—¶å™¨
  32          //     uart0_config();          // å‘é€å’Œæ¥æ”¶æŒ‡ä»¤ä½¿ç”¨åˆ°çš„ä¸²å£
  33          //     pin_level_scan_config(); // åˆ¹è½¦ã€è½¬å‘ç¯ã€æŒ¡ä½çš„æ£€æµ‹å¼•è„šé…ç½®
  34          
  35          //     tmr1_config(); // æ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„è„‰å†²ä¸ªæ•°æ‰€éœ€çš„å®šæ—¶å™¨
  36          //     // tmr2_pwm_config(); // æµ‹è¯•ç”¨çš„PWM
  37          //     speed_scan_config();        // æ—¶é€Ÿæ‰«æçš„é…ç½®
  38          //     engine_speed_scan_config(); // å‘åŠ¨æœºè½¬é€Ÿæ‰«æçš„é…ç½®
  39          
  40          //     tmr3_config(); // å®šæ—¶å°†é‡Œç¨‹å†™å…¥flashæ‰€éœ€çš„å®šæ—¶å™¨
  41          
  42          //     // mileage_init(); // ä»flashä¸­è¯»å‡ºå¤§è®¡é‡Œç¨‹å’Œå°è®¡é‡Œç¨‹æ•°æ®ï¼ˆå·²ç»å¹¶å…¥fun_infoç»“æ
             -„ä½“å˜é‡ä¸­ï¼‰
  43          
  44          //     // p03_output_config(); // è¾“å‡ºé«˜ç”µå¹³ç”¨çš„å¼•è„šï¼Œåˆ°æ—¶å€™æ£€æµ‹adåˆ°äº†ä¸€å®šå€¼ï¼Œå†è®©å
             -®ƒè¾“å‡ºé«˜ç”µå¹³ï¼Œç°åœ¨å®ƒä¸€å¼€å§‹å°±æ˜¯é«˜ç”µå¹³
  45          //     // P03 = 1;
  46          
  47          //     adc_config();
  48          // }
  49          
  50          #if 0 // äº¤ç»™å¦ä¸€ä¸ª3260æ¥æ£€æµ‹è§¦æ‘¸æŒ‰é”®
              /**
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 2   

               * @brief __is_double_click() åˆ¤æ–­æ˜¯å¦æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®,å†…éƒ¨æœ€é•¿å»¶æ—¶æ—¶é—´ï¼šDETECT
             -_DOUBLE_CLICK_INTERVAL
               *
               * @param touch_key_id_const
               * @return u8 0--æ²¡æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œ1--åŒå‡»äº†åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®
               */
              u8 __is_double_click(const u32 touch_key_id_const)
              {
                  u8 i = 0;                   // å¾ªç¯è®¡æ•°å€¼
                  volatile u32 touch_key = 0; // å­˜æ”¾æ¯æ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®
              
                  for (; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                  {
                      delay_ms(1);
                      __tk_scan();
                      touch_key = __tk_key_flag;
              
                      if (touch_key_id_const == touch_key)
                      {
                          // å¦‚æœæ£€æµ‹åˆ°æ˜¯åŒä¸€ä¸ªæŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜æ˜¯åŒå‡»
                          return 1; // åŒå‡»äº†åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œè¿”å›1
                      }
                  }
              
                  return 0; // æ²¡æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œè¿”å›0
              }
              
              enum
              {
                  TOUCH_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
                  TOUCH_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒº
             -åˆ†ï¼‰
                  TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
                  TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
                  TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
              
                  TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
                  TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
                  TOUCH_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
              };
              
              static volatile u8 touch_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
              
              
              // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
              void touch_key_scan(void)
              {
                  volatile u32 touch_key = 0;             // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
                  static u32 touch_key_last = 0;          // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
                  static volatile u32 touch_time_cnt = 0; // é•¿æŒ‰è®¡æ•°å€¼
              
                  /* æŒ‰é”®æ‰«æå‡½æ•° */
                  __tk_scan();               // ä½¿ç”¨äº†åº“é‡Œé¢çš„æ¥å£ï¼ˆé—­æºåº“ï¼‰
                  touch_key = __tk_key_flag; // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
              
                  if (TOUCH_KEY_SCAN_STATUS_NONE == touch_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
                  {
                      // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
                      // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
                      if (touch_key_last == 0) // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®
                      {
                          touch_key_last = touch_key;
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 3   

                      }
                      else if (touch_key_last == touch_key)
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
                          touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
              
                          if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
                          {
                              // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
                              // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
                              touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
                              // printf("long press\n"); // æµ‹è¯•ç”¨
                              touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
                          }
                      }
                      else
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
                          // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
              
                          // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
                          // printf("short press\n"); // æµ‹è¯•ç”¨
                      }
              
                      delay_ms(1); //
                  }
              
                  if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == touch_key_scan_status)
                  {
                      // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
                      bit flag_is_double_click = 0; // æ ‡å¿—ä½ï¼Œæ˜¯å¦æœ‰æŒ‰é”®åŒå‡»
              
                      if (TOUCH_KEY_ID_1 == touch_key_last)
                      {
                          // å¦‚æœKEY1è¢«è§¦æ‘¸
                          flag_is_double_click = __is_double_click(touch_key_last);
                          if (flag_is_double_click)
                          {
                              // å¦‚æœæœ‰æŒ‰é”®åŒå‡»
              #if USE_MY_DEBUG
                              printf("k1 double press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY1); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
                          else
                          {
                              // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                              printf("k1 press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY1); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
                      }
                      else if (TOUCH_KEY_ID_2 == touch_key_last)
                      {
                          // å¦‚æœKEY2è¢«è§¦æ‘¸
                          flag_is_double_click = __is_double_click(touch_key_last);
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 4   

                          if (flag_is_double_click)
                          {
                              // å¦‚æœæœ‰æŒ‰é”®åŒå‡»
              #if USE_MY_DEBUG
                              printf("k2 double press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY2); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
                          else
                          {
                              // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                              printf("k2 press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY2); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
                      }
                      else if (TOUCH_KEY_ID_3 == touch_key_last)
                      {
                          // å¦‚æœKEY3è¢«è§¦æ‘¸
                          flag_is_double_click = __is_double_click(touch_key_last);
                          if (flag_is_double_click)
                          {
                              // å¦‚æœæœ‰æŒ‰é”®åŒå‡»
              #if USE_MY_DEBUG
                              printf("k3 double press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY3); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
                          else
                          {
                              // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                              printf("k3 press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY3); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
                      }
                      else if (TOUCH_KEY_ID_4 == touch_key_last)
                      {
                          // å¦‚æœKEY4è¢«è§¦æ‘¸
                          flag_is_double_click = __is_double_click(touch_key_last);
                          if (flag_is_double_click)
                          {
                              // å¦‚æœæœ‰æŒ‰é”®åŒå‡»
              #if USE_MY_DEBUG
                              printf("k4 double press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY4); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
                          else
                          {
                              // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                              printf("k4 press\n");
              #endif
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 5   

                              // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY4); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
                      }
                      else if (TOUCH_KEY_ID_5 == touch_key_last)
                      {
                          // å¦‚æœKEY5è¢«è§¦æ‘¸
                          flag_is_double_click = __is_double_click(touch_key_last);
                          if (flag_is_double_click)
                          {
                              // å¦‚æœæœ‰æŒ‰é”®åŒå‡»
              #if USE_MY_DEBUG
                              printf("k5 double press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY5); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
                          else
                          {
                              // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                              printf("k5 press\n");
              #endif
                              // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY5); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
                      }
                  }
              
                  if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == touch_key_scan_status)
                  {
                      // å¤„ç†é•¿æŒ‰
                      if (TOUCH_KEY_ID_1 == touch_key)
                      {
                          // å¦‚æœKEY1è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("k1 long press\n");
              #endif
                          // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY1);
                      }
                      else if (TOUCH_KEY_ID_2 == touch_key)
                      {
                          // å¦‚æœKEY2è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("k2 long press\n");
              #endif
                          // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY2);
                      }
                      else if (TOUCH_KEY_ID_3 == touch_key)
                      {
                          // å¦‚æœKEY3è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("k3 long press\n");
              #endif
                          // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY3);
                      }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 6   

                      else if (TOUCH_KEY_ID_4 == touch_key)
                      {
                          // å¦‚æœKEY4è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("k4 long press\n");
              #endif
                          // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY4);
                      }
                      else if (TOUCH_KEY_ID_5 == touch_key)
                      {
                          // å¦‚æœKEY5è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("k5 long press\n");
              #endif
                          // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY5);
                      }
              
                      touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
                  }
              
                  if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == touch_key_scan_status)
                  {
                      // å¤„ç†é•¿æŒ‰æŒç»­
              
                      if (touch_key_last == touch_key)
                      {
                          touch_time_cnt++;
                          if (TOUCH_KEY_ID_1 == touch_key)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("k1 continue press\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY1);
                              }
                          }
                          else if (TOUCH_KEY_ID_2 == touch_key)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("k2 continue press\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY2);
                              }
                          }
                          else if (TOUCH_KEY_ID_3 == touch_key)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("k3 continue press\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY3);
                              }
                          }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 7   

                          else if (TOUCH_KEY_ID_4 == touch_key)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("k4 continue press\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY4);
                              }
                          }
                          else if (TOUCH_KEY_ID_5 == touch_key)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("k5 continue press\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY5);
                              }
                          }
              
                          delay_ms(1);
                      }
                      else
                      {
                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
                          // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
              
                          // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
                      }
                  }
              
                  if ((TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status) ||
                      (TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == touch_key_scan_status))
                  {
                      // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
                      static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
              
                      if (touch_key == 0)
                      {
                          loose_cnt++;
                          delay_ms(1);
                      }
                      else
                      {
                          // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
                          loose_cnt = 0;
                      }
              
                      if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
                      {
                          loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
                          // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
              
                          if (TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status)
                          {
                              if (TOUCH_KEY_ID_1 == touch_key_last)
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 8   

                              {
              #if USE_MY_DEBUG
                                  printf("k1 long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY1);
                              }
                              else if (TOUCH_KEY_ID_2 == touch_key_last)
                              {
              #if USE_MY_DEBUG
                                  printf("k2 long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY2);
                              }
                              else if (TOUCH_KEY_ID_3 == touch_key_last)
                              {
              #if USE_MY_DEBUG
                                  printf("k3 long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY3);
                              }
                              else if (TOUCH_KEY_ID_4 == touch_key_last)
                              {
              #if USE_MY_DEBUG
                                  printf("k4 long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY4);
                              }
                              else if (TOUCH_KEY_ID_5 == touch_key_last)
                              {
              #if USE_MY_DEBUG
                                  printf("k5 long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY5);
                              }
                          }
              
                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
                      }
                  }
              
                  if (TOUCH_KEY_SCAN_STATUS_IS_END == touch_key_scan_status)
                  {
                      // æ”¶å°¾å¤„ç†
                      touch_key = 0;
                      touch_key_last = 0;
                      touch_time_cnt = 0;
              
                      touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_NONE;
                  }
              }
              
              #endif // äº¤ç»™å¦ä¸€ä¸ª3260æ¥æ£€æµ‹è§¦æ‘¸æŒ‰é”®


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.7.0   TK_USER                                                           11/21/2024 14:20:16 PAGE 9   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
