C51 COMPILER V9.60.7.0   MAIN                                                              12/12/2025 16:07:27 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Release\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\main.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\
                    -Listings\main.lst) OBJECT(.\Release\Objects\main.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    main.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-11-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2021 HUGE-IC</center></h2>
  12           *
  13           * ç‰ˆæƒè¯´æ˜ŽåŽç»­è¡¥ä¸Š
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          #include "my_config.h"
  21          
  22          // DEBUG
  23          // volatile bit flag_is_debug_update = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  24          // volatile bit flag_debug_is_send_time = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  25          // volatile bit flag_debug_is_send_time_2 = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  26          
  27          void user_init(void)
  28          {
  29   1          // æŽ§åˆ¶ä¸Šç”µæŒ‡ç¤ºç¯çš„å¼•è„šï¼š
  30   1          P2_MD0 &= ~(GPIO_P23_MODE_SEL(0x03)); // æ¸…ç©ºå¯„å­˜å™¨é…ç½®
  31   1          P2_MD0 |= GPIO_P23_MODE_SEL(0x01);    // è¾“å‡ºæ¨¡å¼
  32   1          FOUT_S23 |= GPIO_FOUT_AF_FUNC;
  33   1      
  34   1          // tmr0_config();  // ä¸²å£æ£€æµ‹æ•°æ®è¶…æ—¶éœ€è¦ä½¿ç”¨åˆ°çš„å®šæ—¶å™¨
  35   1          uart0_config(); // å‘é€å’ŒæŽ¥æ”¶æŒ‡ä»¤ä½¿ç”¨åˆ°çš„ä¸²å£
  36   1      
  37   1      #if PIN_LEVEL_SCAN_ENABLE
  38   1          pin_level_scan_config(); // åˆ¹è½¦ã€è½¬å‘ç¯ã€æŒ¡ä½çš„æ£€æµ‹å¼•è„šé…ç½®
  39   1      #endif
  40   1      
  41   1          tmr1_config(); // æ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„è„‰å†²ä¸ªæ•°æ‰€éœ€çš„å®šæ—¶å™¨(ç”¨äºŽè®¡æ—¶)
  42   1      
  43   1      #if SPEED_SCAN_ENABLE
  44   1          speed_scan_config(); // æ—¶é€Ÿæ‰«æçš„é…ç½®
  45   1      #endif                   // SPEED_SCAN_ENABLE
  46   1      
  47   1      #if ENGINE_SPEED_SCAN_ENABLE
  48   1          engine_speed_scan_config(); // å‘åŠ¨æœºè½¬é€Ÿæ‰«æçš„é…ç½®
  49   1      #endif                          // #if ENGINE_SPEED_SCAN_ENABLE
  50   1      
  51   1      #if (BATTERY_SCAN_ENABLE || AD_KEY_ENABLE || FUEL_CAPACITY_SCAN_ENABLE || TEMP_OF_WATER_SCAN_ENABLE)
  52   1          adc_config();
  53   1      #endif
C51 COMPILER V9.60.7.0   MAIN                                                              12/12/2025 16:07:27 PAGE 2   

  54   1      
  55   1      #if TOUCH_KEY_ENABLE
                  tk_param_init(); // è§¦æ‘¸æŒ‰é”®æ¨¡å—åˆå§‹åŒ–
              #endif
  58   1      
  59   1      #if IC_1302_ENABLE
  60   1          aip1302_config(); // åˆå§‹åŒ–æ—¶é’Ÿicï¼Œå‡½æ•°å†…éƒ¨ä¼šè¯»å–æ—¶é—´ä¿¡æ¯ï¼Œå¹¶å­˜æ”¾åˆ°å…¨å±€å˜é‡ä
             -¸­
  61   1      #endif
  62   1      
  63   1          tmr2_config(); // æ‰«æè„‰å†²(ç”µå¹³å˜åŒ–)çš„å®šæ—¶å™¨
  64   1      
  65   1          // iic_config();
  66   1      
  67   1          // eeprom_24cxx_clear(); // å…¨ç‰‡æ“¦é™¤
  68   1      
  69   1          // printf("begin read eeprom\n");
  70   1          fun_info_init(); // åˆå§‹åŒ–ç”¨äºŽå­˜æ”¾ä¿¡æ¯çš„å˜é‡
  71   1      
  72   1          // delay_ms(10); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  73   1          delay_ms(1); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  74   1          // delay_ms(2000); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  75   1      }
  76          
  77          void main(void)
  78          {
  79   1          // çœ‹é—¨ç‹—é»˜è®¤æ‰“å¼€, å¤ä½æ—¶é—´2s
  80   1          system_init();
  81   1      
  82   1          // WDT_KEY = WDT_KEY_VAL(0xDD); //  å…³é—­çœ‹é—¨ç‹—
  83   1      
  84   1          // å…³é—­HCKå’ŒHDAçš„è°ƒè¯•åŠŸèƒ½
  85   1          WDT_KEY = 0x55;  // è§£é™¤å†™ä¿æŠ¤
  86   1          IO_MAP &= ~0x01; // æ¸…é™¤è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå®žçŽ°å…³é—­HCKå’ŒHDAå¼•è„šçš„è°ƒè¯•åŠŸèƒ½ï¼ˆè§£é™¤æ
             -˜ å°„ï¼‰
  87   1          WDT_KEY = 0xBB;
  88   1      
  89   1          /* ç”¨æˆ·ä»£ç åˆå§‹åŒ–æŽ¥å£ */
  90   1          user_init();
  91   1      
  92   1          // printf("sys reset\n");
  93   1      
  94   1          // ä¸Šç”µåŽï¼Œéœ€è¦ç‚¹äº®ä¸€ä¸‹æ‰€æœ‰çš„æŒ‡ç¤ºç¯ï¼Œå†å…³é—­:
  95   1          P23 = 1;
  96   1          delay_ms(1000);
  97   1          P23 = 0;
  98   1      
  99   1          /* ç³»ç»Ÿä¸»å¾ªçŽ¯ */
 100   1          while (1)
 101   1          {
 102   2              // printf("main circle\n");
 103   2      
 104   2      #if 1
 105   2              WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
 106   2      
 107   2      #if TOUCH_KEY_ENABLE
                      /* æŒ‰é”®æ‰«æå‡½æ•° */
                      __tk_scan();                 // ä½¿ç”¨äº†åº“é‡Œé¢çš„æŽ¥å£ï¼ˆé—­æºåº“ï¼‰
                      WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
              #endif
 112   2      
 113   2      #if AD_KEY_ENABLE
C51 COMPILER V9.60.7.0   MAIN                                                              12/12/2025 16:07:27 PAGE 3   

                      key_driver_scan(&ad_key_para);
                      ad_key_handle(); // adæŒ‰é”®å¤„ç†å‡½æ•°
              #endif                   //  #if AD_KEY_ENABLE
 117   2      
 118   2      #if TOUCH_KEY_ENABLE
                      key_driver_scan(&touch_key_para);
                      touch_key_handle(); // è§¦æ‘¸æŒ‰é”®å¤„ç†å‡½æ•°
              #endif
 122   2      #if PIN_LEVEL_SCAN_ENABLE
 123   2              pin_level_scan();
 124   2      #endif
 125   2      #if SPEED_SCAN_ENABLE
 126   2      
 127   2              speed_scan(); // æ£€æµ‹æ—¶é€Ÿ
 128   2      
 129   2      #endif // #if SPEED_SCAN_ENABLE
 130   2      
 131   2      #if ENGINE_SPEED_SCAN_ENABLE
 132   2              engine_speed_scan(); // æ£€æµ‹å‘åŠ¨æœºè½¬é€Ÿ
 133   2      #endif                       // #if ENGINE_SPEED_SCAN_ENABLE
 134   2              mileage_scan();      // æ£€æµ‹å¤§è®¡é‡Œç¨‹å’Œå°è®¡é‡Œç¨‹
 135   2      
 136   2      #if FUEL_CAPACITY_SCAN_ENABLE
 137   2              fuel_capacity_scan(); // æ²¹é‡æ£€æµ‹
 138   2      #endif                        // FUEL_CAPACITY_SCAN_ENABLE
 139   2      #if BATTERY_SCAN_ENABLE
 140   2              battery_scan(); // ç”µæ± ç”µé‡æ£€æµ‹
 141   2      #endif                  // BATTERY_SCAN_ENABLE
 142   2      
 143   2      #if 1
 144   2              uart0_scan_handle();  // æ£€æŸ¥ä¸²å£æŽ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®æ˜¯å¦ç¬¦åˆåè®®,å¦‚æžœæœ‰æ­£ç¡®çš„
             -æŒ‡ä»¤ï¼Œä¼šå­˜åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼ˆæŽ¥ä¸‹æ¥è®©instruction_scan()å‡½æ•°æ¥å¤„ç†ï¼‰
 145   2              instruction_scan();   // æ‰«ææ˜¯å¦æœ‰åˆæ³•çš„æŒ‡ä»¤
 146   2              instruction_handle(); // æ‰«ææ˜¯å¦æœ‰å¯¹åº”çš„èŽ·å–/çŠ¶æ€æ›´æ–°æ“ä½œ(æœ€å ç”¨æ—¶é—´,å› ä¸ºè
             -¦ç­‰å¾…ä¸²å£çš„æ•°æ®å‘é€å®Œæˆ)
 147   2      #endif
 148   2      
 149   2              // DEBUG:
 150   2              // if (flag_debug_is_send_time)
 151   2              // {
 152   2              //     eeprom_printf_all();
 153   2              //     flag_debug_is_send_time = 0;
 154   2              // }
 155   2      
 156   2      #endif //
 157   2      
 158   2              // fun_info.save_info.total_mileage = (u32)417650;
 159   2              // send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_KM);
 160   2              // send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_MILE);
 161   2      
 162   2              // {
 163   2              //     static u16 cnt = 0;
 164   2              //     static u8 dir = 0;
 165   2      
 166   2              //     cnt++;
 167   2              //     if (cnt >= 100)
 168   2              //     // if (cnt >= 10)
 169   2              //     {
 170   2              //         cnt = 0;
 171   2              //         // fun_info.left_turn = dir;
 172   2              //         // fun_info.right_turn = dir;
 173   2              //         dir = !dir;
C51 COMPILER V9.60.7.0   MAIN                                                              12/12/2025 16:07:27 PAGE 4   

 174   2              //         // send_data_packet(SEND_LEFT_TURN);
 175   2              //         // send_data_packet(SEND_RIGHT_TURN);
 176   2      
 177   2              //         // if (0 == dir)
 178   2              //         // {
 179   2              //         //     fun_info.gear = GEAR_FIFTH;
 180   2              //         // }
 181   2              //         // else
 182   2              //         // {
 183   2              //         //     fun_info.gear = GEAR_SECOND;
 184   2              //         // }
 185   2      
 186   2              //         {
 187   2              //             static u8 i = 0;
 188   2              //             i++;
 189   2              //             if (i >= 100)
 190   2              //             {
 191   2              //                 i = 0;
 192   2              //             }
 193   2      
 194   2              //             // fun_info.left_turn = 0;
 195   2              //             // send_data_packet(SEND_LEFT_TURN);
 196   2      
 197   2              //             fun_info.save_info.total_mileage = (u32)89432 * 1000;
 198   2              //             // fun_info.aip1302_saveinfo.time_hour = 16;
 199   2              //             // fun_info.aip1302_saveinfo.time_min = 59;
 200   2              //             // fun_info.aip1302_saveinfo.time_sec = 34;
 201   2              //             // fun_info.flag_is_in_water_temp_warning = dir;
 202   2              //             // fun_info.flag_is_detect_malfunction = dir;
 203   2      
 204   2              //             // fun_info.save_info.subtotal_mileage = (u32)123456 * 100;
 205   2              //             send_data_packet(SEND_TOTAL_MILEAGE_TENTH_OF_KM);
 206   2              //         }
 207   2              //     }
 208   2              // }
 209   2      
 210   2              // WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
 211   2          }
 212   1      }
 213          
 214          /**
 215           * @}
 216           */
 217          
 218          /*************************** (C) COPYRIGHT 2022 HUGE-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    111    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
