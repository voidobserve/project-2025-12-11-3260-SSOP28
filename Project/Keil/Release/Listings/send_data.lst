C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE SEND_DATA
OBJECT MODULE PLACED IN .\Release\Objects\send_data.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\send_data.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X0
                    -00C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Rel
                    -ease\Listings\send_data.lst) OBJECT(.\Release\Objects\send_data.obj)

line level    source

   1          #include "send_data.h"
   2          
   3          #if 0
              /**
               * @brief é€šè¿‡ä¸²å£å‘é€æ•°æ®
               *
               * @param instruct æŒ‡ä»¤
               * @param send_data å¾…å‘é€çš„æ•°æ®ï¼Œå¦‚æœè¦å‘é€æ—¶é—´ï¼Œè¯¥å‚æ•°æ— æ•ˆï¼Œå› ä¸ºæ—¶é—´ä¿¡æ¯ä¸€å…
             -±7ä¸ªå­—èŠ‚
               */
              void send_data(SEND_DATA_CMD_T instruct, u32 send_data)
              {
                  u32 check_num = 0; // å­˜æ”¾æ ¡éªŒå’Œ
              
                  uart0_sendbyte(FORMAT_HEAD); // å…ˆå‘é€æ ¼å¼å¤´
              
                  check_num += FORMAT_HEAD; // ä½¿ç”¨if()è¯­å¥æ—¶ï¼Œæ‰ä½¿ç”¨è¿™ä¸€æ¡ç¨‹åº
              
                  if (SEND_GEAR == instruct ||                /* å‘é€æŒ¡ä½çš„çŠ¶æ€ */
                      SEND_BATTERY == instruct ||             /* å‘é€ç”µæ± ç”µé‡çš„çŠ¶æ€ */
                      SEND_BARKE == instruct ||               /* å‘é€åˆ¹è½¦çš„çŠ¶æ€ */
                      SEND_LEFT_TURN == instruct ||           /* å‘é€å·¦è½¬å‘ç¯çš„çŠ¶æ€ */
                      SEND_RIGHT_TURN == instruct ||          /* å‘é€å³è½¬å‘ç¯çš„çŠ¶æ€ */
                      SEND_HIGH_BEAM == instruct ||           /* å‘é€è¿œå…‰ç¯çš„çŠ¶æ€ */
                      SEND_FUEL == instruct ||                /* å‘é€æ²¹é‡ */
                      SEND_WATER_TEMP == instruct ||          /* å‘é€æ°´æ¸© */
                      SEND_TEMP_OF_WATER_ALERT == instruct || /* å‘é€æ°´æ¸©æŠ¥è­¦ */
                      SEND_MALFUNCTION_STATUS == instruct ||  /* å‘é€æ•…éšœçš„çŠ¶æ€ */
                      SEND_ABS_STATUS == instruct             /* å‘é€ABSçš„çŠ¶æ€ */
                      )                                       // å¦‚æœæŒ‡ä»¤çš„æ€»é•¿åº¦åªæœ‰5ä¸ªå­—èŠ‚
                  {
                      uart0_sendbyte(0x05);     // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
                      uart0_sendbyte(instruct); // å‘é€æŒ‡ä»¤
                      uart0_sendbyte(send_data);
              
                      check_num += 0x05 + (u8)instruct + (u8)send_data;
                  }
                  else if (SEND_ENGINE_SPEED == instruct ||    /* å‘é€å‘åŠ¨æœºçš„è½¬é€Ÿ */
                           SEND_SPEED == instruct ||           /* å‘é€æ—¶é€Ÿ */
                           SEND_SPEED_WITH_MILE == instruct || /* ï¼ˆå•ä½ï¼šè‹±é‡Œæ¯å°æ—¶ mile/hï¼‰ */
                           SEND_VOLTAGE_OF_BATTERY == instruct /* å‘é€ç”µæ± ç”µå‹ */
                           )                                   // å¦‚æœæŒ‡ä»¤çš„æ€»é•¿åº¦ä¸º6ä¸ªå­—èŠ‚
                  {
                      uart0_sendbyte(0x06);           // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
                      uart0_sendbyte(instruct);       // å‘é€æŒ‡ä»¤
                      uart0_sendbyte(send_data >> 8); // å‘é€ä¿¡æ¯
                      uart0_sendbyte(send_data);      // å‘é€ä¿¡æ¯
              
                      check_num += 0x06 + (u8)instruct + (u8)(send_data >> 8) + (u8)(send_data);
                  }
                  else if (
                      // SEND_SUBTOTAL_MILEAGE_2 == instruct ||                    /* å‘é€å°è®¡é‡Œç¨‹2 */
                      // SEND_TOTAL_MILEAGE_WITH_MILE == instruct ||               /* å‘é€å¤§è®¡é‡Œç¨‹ï¼ˆæ€»é‡Œç¨‹ï¼Œå
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 2   

             -•ä½ï¼šè‹±é‡Œ mileï¼‰ */
                      // SEND_SUBTOTAL_MILEAGE_WITH_TENTH_OF_MILE == instruct ||   /* å‘é€å°è®¡é‡Œç¨‹ï¼ˆæ€»é‡Œç¨‹ï¼Œå
             -•ä½ï¼š0.1 è‹±é‡Œ 0.1 mileï¼‰ */
                      // SEND_SUBTOTAL_MILEAGE_2_WITH_TENTH_OF_MILE == instruct || /* å‘é€å°è®¡é‡Œç¨‹2ï¼ˆæ€»é‡Œç¨‹ï¼Œ
             -å•ä½ï¼š0.1 è‹±é‡Œ 0.1 mileï¼‰ */
                      SEND_TOUCH_KEY_STATUS == instruct /* å‘é€è§¦æ‘¸æŒ‰é”®çš„çŠ¶æ€ */
                      )                                 // å¦‚æœæŒ‡ä»¤çš„æ€»é•¿åº¦ä¸º7ä¸ªå­—èŠ‚
                  {
              
                      uart0_sendbyte(0x07);     // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
                      uart0_sendbyte(instruct); // å‘é€æŒ‡ä»¤
              
                      uart0_sendbyte(send_data >> 16); // å‘é€ä¿¡æ¯
                      uart0_sendbyte(send_data >> 8);  // å‘é€ä¿¡æ¯
                      uart0_sendbyte(send_data);       // å‘é€ä¿¡æ¯
              
                      check_num += 0x07 + (u8)instruct + (u8)(send_data >> 16) + (u8)(send_data >> 8) + (u8)send_data;
                  }
                  // else if (SEND_DATE == instruct /* å‘é€æ—¥æœŸ(å¹´æœˆæ—¥) */
                  //          )                     // å¦‚æœæŒ‡ä»¤çš„æ€»é•¿åº¦ä¸º8ä¸ªå­—èŠ‚
                  // {
                  //     uart0_sendbyte(0x08);     // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
                  //     uart0_sendbyte(instruct); // å‘é€æŒ‡ä»¤
              
                  //     uart0_sendbyte(send_data >> 24); // å‘é€ä¿¡æ¯
                  //     uart0_sendbyte(send_data >> 16); // å‘é€ä¿¡æ¯
                  //     uart0_sendbyte(send_data >> 8);  // å‘é€ä¿¡æ¯
                  //     uart0_sendbyte(send_data);       // å‘é€ä¿¡æ¯
              
                  //     check_num += 0x08 + (u8)instruct + (u8)(send_data >> 24) + (u8)(send_data >> 16) + (u8)(send_da
             -ta >> 8) + (u8)send_data;
                  // }
                  else if (SEND_TIME == instruct /* å‘é€æ—¶é—´ */)
                  {
                      uart0_sendbyte(0x0B);      // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
                      uart0_sendbyte(SEND_TIME); // å‘é€æŒ‡ä»¤
              
                      // uart0_sendbyte(send_data >> 24); // å‘é€ä¿¡æ¯
                      // uart0_sendbyte(send_data >> 16); // å‘é€ä¿¡æ¯
                      // uart0_sendbyte(send_data >> 8);  // å‘é€ä¿¡æ¯
                      // uart0_sendbyte(send_data);       // å‘é€ä¿¡æ¯
              
                      uart0_sendbyte(fun_info.aip1302_saveinfo.year >> 8);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.year & 0xFF);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.month);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.day);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.time_hour);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.time_min);
                      uart0_sendbyte(fun_info.aip1302_saveinfo.time_sec);
              
                      check_num += 0x0B +
                                   (u8)SEND_TIME +
                                   (u8)(fun_info.aip1302_saveinfo.year >> 8) +
                                   (u8)(fun_info.aip1302_saveinfo.year & 0xFF) +
                                   (u8)(fun_info.aip1302_saveinfo.month) +
                                   (u8)(fun_info.aip1302_saveinfo.day) +
                                   (u8)(fun_info.aip1302_saveinfo.time_hour) +
                                   (u8)(fun_info.aip1302_saveinfo.time_min) +
                                   (u8)(fun_info.aip1302_saveinfo.time_sec);
                  }
              
                  // check_num &= 0x0F;         // å–å‰é¢çš„æ•°å­—ç›¸åŠ çš„ä½å››ä½
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 3   

                  check_num &= 0xFF;         // å–å‰é¢çš„æ•°å­—ç›¸åŠ çš„ä½å…«ä½
                  uart0_sendbyte(check_num); // å‘é€æ ¡éªŒå’Œ
              
                  delay_ms(1);
                  // delay_ms(10); // æ¯æ¬¡å‘é€å®Œæˆåï¼Œå»¶æ—¶10ms
              }
              #endif
 118          
 119          void send_data_packet(SEND_DATA_CMD_T cmd)
 120          {
 121   1          /*
 122   1              å‘é€æ‰€ä½¿ç”¨çš„å˜é‡éœ€è¦æ”¹æˆ volatile ç±»å‹ï¼Œ
 123   1              æµ‹è¯•å‘ç°ï¼Œå¦‚æœæ²¡æœ‰ç”¨ volatile ä¿®é¥°ï¼Œ
 124   1              æ¥æ”¶ç«¯åœ¨æ ¡éªŒé˜¶æ®µæœ‰å°æ¦‚ç‡ä¼šå¾—åˆ°è®¡ç®—çš„æ ¡éªŒå’Œä¸å­˜æ”¾çš„æ ¡éªŒå’Œä¸ä¸€è‡´çš„æƒ
             -…å†µ
 125   1          */ 
 126   1          static volatile u8 send_data_packet[SEND_DATA_BUFF_MAX_LEN];
 127   1          volatile u8 send_data_packet_len = 0;
 128   1          volatile u8 check_sum = 0;
 129   1          volatile u8 i = 0;
 130   1          volatile u32 tmp_val = 0;
 131   1      
 132   1          send_data_packet[0] = FORMAT_HEAD; // [0] ï¼Œ æ ¼å¼å¤´
 133   1          send_data_packet[2] = cmd;         // [2] ï¼Œ æŒ‡ä»¤
 134   1      
 135   1          switch (cmd)
 136   1          {
 137   2          // ====================================================================
 138   2          // å‘é€æ¡£ä½
 139   2          case SEND_GEAR:
 140   2          {
 141   3              send_data_packet_len = 5; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 142   3              send_data_packet[1] = send_data_packet_len;
 143   3              send_data_packet[3] = fun_info.gear;
 144   3          }
 145   2          break;
 146   2          // ====================================================================
 147   2          // å‘é€ç”µæ± ç”µé‡
 148   2          case SEND_BATTERY:
 149   2          {
 150   3              send_data_packet_len = 5; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 151   3              send_data_packet[1] = send_data_packet_len;
 152   3              send_data_packet[3] = fun_info.battery;
 153   3          }
 154   2          break;
 155   2          // ====================================================================
 156   2          // å‘é€åˆ¹è½¦çš„çŠ¶æ€
 157   2          case SEND_BARKE:
 158   2          {
 159   3              send_data_packet_len = 5;
 160   3              send_data_packet[1] = send_data_packet_len;
 161   3              send_data_packet[3] = fun_info.brake;
 162   3          }
 163   2          break;
 164   2          // ====================================================================
 165   2          // å‘é€å·¦è½¬å‘ç¯çš„çŠ¶æ€
 166   2          case SEND_LEFT_TURN:
 167   2          {
 168   3              send_data_packet_len = 5;
 169   3              send_data_packet[1] = send_data_packet_len;
 170   3              send_data_packet[3] = fun_info.left_turn;
 171   3          }
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 4   

 172   2          break;
 173   2      
 174   2          // ====================================================================
 175   2          // å‘é€å³è½¬å‘ç¯çš„çŠ¶æ€
 176   2          case SEND_RIGHT_TURN:
 177   2          {
 178   3              send_data_packet_len = 5;
 179   3              send_data_packet[1] = send_data_packet_len;
 180   3              send_data_packet[3] = fun_info.right_turn;
 181   3          }
 182   2          break;
 183   2          // ====================================================================
 184   2          // å‘é€ è¿œå…‰ç¯ çš„çŠ¶æ€
 185   2          case SEND_HIGH_BEAM:
 186   2          {
 187   3              send_data_packet_len = 5;
 188   3              send_data_packet[1] = send_data_packet_len;
 189   3              send_data_packet[3] = fun_info.high_beam;
 190   3          }
 191   2          break;
 192   2          // ====================================================================
 193   2          // å‘é€ å‘åŠ¨æœºçš„è½¬é€Ÿ
 194   2          case SEND_ENGINE_SPEED:
 195   2          {
 196   3              send_data_packet_len = 6;
 197   3              send_data_packet[1] = send_data_packet_len;
 198   3              send_data_packet[3] = fun_info.engine_speeed >> 8;
 199   3              send_data_packet[4] = fun_info.engine_speeed;
 200   3          }
 201   2          break;
 202   2          // ====================================================================
 203   2          // å‘é€ æ—¶é€Ÿ
 204   2          case SEND_SPEED:
 205   2          {
 206   3              // é™åˆ¶è¦å‘é€çš„æ—¶é€Ÿ:
 207   3              if (fun_info.speed > 255)
 208   3              {
 209   4                  fun_info.speed = 255;
 210   4              }
 211   3      
 212   3              send_data_packet_len = 5;
 213   3              send_data_packet[1] = send_data_packet_len;
 214   3              send_data_packet[3] = (u8)(fun_info.speed & 0xFF);
 215   3          }
 216   2          break;
 217   2          // ====================================================================
 218   2          // å‘é€ æ²¹é‡
 219   2          case SEND_FUEL:
 220   2          {
 221   3              send_data_packet_len = 5;
 222   3              send_data_packet[1] = send_data_packet_len;
 223   3              send_data_packet[3] = fun_info.fuel;
 224   3          }
 225   2          break;
 226   2          // ====================================================================
 227   2          // // å‘é€ æ°´æ¸©
 228   2          // case SEND_WATER_TEMP:
 229   2          // {
 230   2          //     send_data_packet_len = 5;
 231   2          //     send_data_packet[1] = send_data_packet_len;
 232   2          //     send_data_packet[3] = fun_info.temp_of_water;
 233   2          // }
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 5   

 234   2          // break;
 235   2          // ====================================================================
 236   2          // å‘é€å¤§è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œä¾‹å¦‚ 0d 04 17 65 ï¼Œæ˜¾ç
             -¤º 041765 km
 237   2          case SEND_TOTAL_MILEAGE_TENTH_OF_KM:
 238   2          {
 239   3              send_data_packet_len = 7; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 240   3              send_data_packet[1] = send_data_packet_len;
 241   3      
 242   3              /*
 243   3                  å‘é€çš„æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œè¿™é‡Œéœ€è¦æå‰åšå¥½è½¬æ¢
 244   3              */
 245   3              tmp_val = fun_info.save_info.total_mileage / 1000; // å­˜æ”¾ä»¥ km ä¸ºå•ä½çš„æ•°æ®
 246   3              send_data_packet[5] = tmp_val % 100;
 247   3              tmp_val /= 100;
 248   3              send_data_packet[4] = tmp_val % 100;
 249   3              tmp_val /= 100;
 250   3              send_data_packet[3] = tmp_val % 100;
 251   3          }
 252   2          break;
 253   2          // ====================================================================
 254   2          // å‘é€å¤§è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œä¾‹å¦‚ 0d 04 17 65 ï¼Œæ˜¾ç
             -¤º 041765 mile
 255   2          case SEND_TOTAL_MILEAGE_TENTH_OF_MILE:
 256   2          {
 257   3              send_data_packet_len = 7; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 258   3              send_data_packet[1] = send_data_packet_len;
 259   3      
 260   3              /*
 261   3                  å‘é€çš„æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œè¿™é‡Œéœ€è¦æå‰åšå¥½è½¬æ¢
 262   3      
 263   3                  1 km == 0.621371 mile
 264   3                  1 / 0.621371 çº¦ä¸º 1.6093444978925633800096882538773ï¼Œ
 265   3                  è¿™é‡Œå– 1.61 ä½œä¸ºè½¬æ¢ç³»æ•°
 266   3                  1000 m / 161 ï¼Œå¾—åˆ° ä»¥ 0.1 mile ä¸ºå•ä½çš„æ•°æ®
 267   3              */
 268   3              tmp_val = fun_info.save_info.total_mileage / 1610 ; // å¾—åˆ°ä»¥ mile ä¸ºå•ä½çš„æ•°æ®
 269   3              send_data_packet[5] = tmp_val % 100;
 270   3              tmp_val /= 100;
 271   3              send_data_packet[4] = tmp_val % 100;
 272   3              tmp_val /= 100;
 273   3              send_data_packet[3] = tmp_val % 100;
 274   3          }
 275   2          break;
 276   2          // ====================================================================
 277   2          // å‘é€ æ—¶é—´ï¼ˆå¹´æœˆæ—¥ï¼Œæ—¶åˆ†ç§’ï¼‰
 278   2          case SEND_TIME:
 279   2          {
 280   3              send_data_packet_len = 11; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 281   3              send_data_packet[1] = send_data_packet_len;
 282   3      
 283   3              send_data_packet[3] = fun_info.aip1302_saveinfo.year >> 8;
 284   3              send_data_packet[4] = fun_info.aip1302_saveinfo.year & 0xFF;
 285   3              send_data_packet[5] = fun_info.aip1302_saveinfo.month;
 286   3              send_data_packet[6] = fun_info.aip1302_saveinfo.day;
 287   3              send_data_packet[7] = fun_info.aip1302_saveinfo.time_hour;
 288   3              send_data_packet[8] = fun_info.aip1302_saveinfo.time_min;
 289   3              send_data_packet[9] = fun_info.aip1302_saveinfo.time_sec;
 290   3          }
 291   2          break;
 292   2          // ====================================================================
 293   2          // å‘é€ ç”µæ± ç”µå‹
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 6   

 294   2          case SEND_VOLTAGE_OF_BATTERY:
 295   2          {
 296   3              send_data_packet_len = 6; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 297   3              send_data_packet[1] = send_data_packet_len;
 298   3      
 299   3              send_data_packet[3] = fun_info.voltage_of_battery >> 8;
 300   3              send_data_packet[4] = fun_info.voltage_of_battery & 0xFF;
 301   3          }
 302   2          break;
 303   2          // ====================================================================
 304   2          // å‘é€ æ°´æ¸©æŠ¥è­¦
 305   2          // case SEND_TEMP_OF_WATER_ALERT:
 306   2          // {
 307   2          //     send_data_packet_len = 5;
 308   2          //     send_data_packet[1] = send_data_packet_len;
 309   2          //     // send_data_packet[3] = ;
 310   2          // }
 311   2          // ====================================================================
 312   2          // å‘é€ å‘é€å°è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œä¾‹å¦‚ 0d 04 17 65 
             -ï¼Œæ˜¾ç¤º 04176.5 km
 313   2          case SEND_SUBTOTAL_MILEAGE_TENTH_OF_KM:
 314   2          {
 315   3              send_data_packet_len = 7; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 316   3              send_data_packet[1] = send_data_packet_len;
 317   3      
 318   3              /*
 319   3                  å‘é€çš„æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œè¿™é‡Œéœ€è¦æå‰åšå¥½è½¬æ¢
 320   3              */
 321   3              tmp_val = fun_info.save_info.subtotal_mileage / 100; // å­˜æ”¾ä»¥ç™¾ç±³ä¸ºå•ä½çš„æ•°æ®
 322   3              send_data_packet[5] = tmp_val % 100;
 323   3              tmp_val /= 100;
 324   3              send_data_packet[4] = tmp_val % 100;
 325   3              tmp_val /= 100;
 326   3              send_data_packet[3] = tmp_val % 100;
 327   3          }
 328   2          break;
 329   2          // ====================================================================
 330   2          // å‘é€ å‘é€å°è®¡é‡Œç¨‹ï¼Œ æ•°æ® 3 byte ï¼Œ æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œä¾‹å¦‚ 0d 04 17 65 
             -ï¼Œæ˜¾ç¤º 04176.5 mile
 331   2          case SEND_SUBTOTAL_MILEAGE_TENTH_OF_MILE:
 332   2          {
 333   3              send_data_packet_len = 7; // å‘é€æŒ‡ä»¤çš„æ€»é•¿åº¦
 334   3              send_data_packet[1] = send_data_packet_len;
 335   3      
 336   3              /*
 337   3                  å‘é€çš„æ•°æ®ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œè¿™é‡Œéœ€è¦æå‰åšå¥½è½¬æ¢
 338   3      
 339   3                  1 km == 0.621371 mile
 340   3                  1 / 0.621371 çº¦ä¸º 1.6093444978925633800096882538773ï¼Œ
 341   3                  è¿™é‡Œå– 1.61 ä½œä¸ºè½¬æ¢ç³»æ•°
 342   3                  1000 m / 161 ï¼Œå¾—åˆ° ä»¥ 0.1 mile ä¸ºå•ä½çš„æ•°æ®
 343   3              */
 344   3              tmp_val = fun_info.save_info.subtotal_mileage / 161; // å¾—åˆ° ä»¥ 0.1 mile ä¸ºå•ä½çš„æ•°æ®
 345   3              send_data_packet[5] = tmp_val % 100;
 346   3              tmp_val /= 100;
 347   3              send_data_packet[4] = tmp_val % 100;
 348   3              tmp_val /= 100;
 349   3              send_data_packet[3] = tmp_val % 100;
 350   3          }
 351   2          break;
 352   2          // ====================================================================
 353   2          /*
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 7   

 354   2              å‘é€ å°è®¡é‡Œç¨‹ï¼Œ æ•°æ® 2 byte ï¼Œ ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œ
 355   2              ä¾‹å¦‚ 0d 1765 ï¼Œæ˜¾ç¤º 1765 km
 356   2          */
 357   2          case SEND_SUBTOTAL_MILEAGE_KM:
 358   2          {
 359   3              send_data_packet_len = 6;
 360   3              send_data_packet[1] = send_data_packet_len;
 361   3      
 362   3              tmp_val = fun_info.save_info.subtotal_mileage / 1000; // å¾—åˆ°ä»¥ km ä¸ºå•ä½çš„æ•°æ®
 363   3              send_data_packet[4] = tmp_val % 100;
 364   3              tmp_val /= 100;
 365   3              send_data_packet[3] = tmp_val % 100;
 366   3          }
 367   2          break;
 368   2          // ====================================================================
 369   2          /*
 370   2              å‘é€ å°è®¡é‡Œç¨‹ï¼Œ æ•°æ® 2 byte ï¼Œ ç›´æ¥ç”¨ä½œå±å¹•æ˜¾ç¤ºï¼Œ
 371   2              ä¾‹å¦‚ 0d 1765 ï¼Œæ˜¾ç¤º 1765 mile
 372   2          */
 373   2          case SEND_SUBTOTAL_MILEAGE_MILE:
 374   2          {
 375   3              send_data_packet_len = 6;
 376   3              send_data_packet[1] = send_data_packet_len;
 377   3      
 378   3              tmp_val = fun_info.save_info.subtotal_mileage / 1610; // å¾—åˆ°ä»¥ mile ä¸ºå•ä½æ•°æ®
 379   3              send_data_packet[4] = tmp_val % 100;
 380   3              tmp_val /= 100;
 381   3              send_data_packet[3] = tmp_val % 100;
 382   3          }
 383   2          break;
 384   2          // ====================================================================
 385   2          // å‘é€ æ—¶é€Ÿï¼ˆå•ä½ï¼šè‹±é‡Œæ¯å°æ—¶ mile/hï¼‰
 386   2          case SEND_SPEED_WITH_MILE:
 387   2          {
 388   3              tmp_val = fun_info.speed * 621 / 1000; // ï¼ˆå•ä½ï¼šè‹±é‡Œæ¯å°æ—¶ mile/hï¼‰ 1km/h == 0.621427m
             -ile/h
 389   3              if (tmp_val > 255)
 390   3              {
 391   4                  tmp_val = 255; // é™åˆ¶å‘é€çš„æ—¶é€Ÿ
 392   4              }
 393   3      
 394   3              send_data_packet_len = 5;
 395   3              send_data_packet[1] = send_data_packet_len;
 396   3      
 397   3              send_data_packet[3] = (u8)(tmp_val & 0xFF);
 398   3          }
 399   2          break;
 400   2      
 401   2          default:
 402   2              break;
 403   2          }
 404   1      
 405   1          for (i = 0; i < send_data_packet_len; i++)
 406   1          {
 407   2              if (i == send_data_packet_len - 1)
 408   2              {
 409   3                  // æ•°æ®åŒ…çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå­˜æ”¾æ ¡éªŒå’Œ
 410   3                  send_data_packet[i] = check_sum;
 411   3              }
 412   2              uart0_sendbyte(send_data_packet[i]);
 413   2              check_sum += (u8)send_data_packet[i]; // åªç”¨1ä¸ªå­—èŠ‚å­˜æ”¾æ ¡éªŒå’Œï¼Œæº¢å‡ºçš„éƒ¨åˆ†ä¸ç”¨å¤
             -„ç†
C51 COMPILER V9.60.7.0   SEND_DATA                                                         12/05/2025 17:29:00 PAGE 8   

 414   2          }
 415   1      
 416   1          delay_ms(1);
 417   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    679    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     20       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
